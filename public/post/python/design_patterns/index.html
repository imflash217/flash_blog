<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ronalds Vilcins - http://localhost:1313/"><title>| Vinay Kumar</title>
<meta name=description content><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content='STRATEGY Pattern # from abc import ABC, abstractmethod from collections import namedtuple Customer = namedtuple("Customer", "name fidelity") class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantity class Order: """This is the CONTEXT part of the Strategy-Pattern""" def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, "__total"): self.'><meta property="og:title" content><meta property="og:description" content='STRATEGY Pattern # from abc import ABC, abstractmethod from collections import namedtuple Customer = namedtuple("Customer", "name fidelity") class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantity class Order: """This is the CONTEXT part of the Strategy-Pattern""" def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, "__total"): self.'><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/python/design_patterns/"><meta property="article:section" content="post"><meta itemprop=name content><meta itemprop=description content='STRATEGY Pattern # from abc import ABC, abstractmethod from collections import namedtuple Customer = namedtuple("Customer", "name fidelity") class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantity class Order: """This is the CONTEXT part of the Strategy-Pattern""" def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, "__total"): self.'><meta itemprop=wordCount content="1113"><meta itemprop=keywords content><link rel=canonical href=http://localhost:1313/post/python/design_patterns/><link rel=dns-prefetch href=https://www.google-analytics.com><link href=https://www.google-analytics.com rel=preconnect crossorigin><link rel=alternate type=application/atom+xml title="Vinay Kumar" href=http://localhost:1313/atom.xml><link rel=alternate type=application/json title="Vinay Kumar" href=http://localhost:1313/feed.json><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeSpeed}.posts hr{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:none;border-bottom:1px #353535;flex:1 0 1rem}main{max-width:70ch;padding:2ch;margin:auto}a,body{color:#353535}::selection,a:focus,a:hover{background-color:#353535;color:#fff}.meta{margin:0 0 2.5rem}.tags::before{content:"\2022";margin-left:1rem}code,pre{color:#353535;font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;border:1px solid #353535;font-size:small}.highlight [class^=language-]{color:#fff}code{padding:.1rem;border:none}pre{padding:.5rem;overflow-x:auto}pre code{border:none}img{max-width:100%;border:1px solid #353535}hr{background:#353535;height:1px;border:0}ul{list-style-type:square}ul,ol{padding-left:1.2rem}header li,footer li{display:inline;text-transform:uppercase}header a,footer a{text-decoration:none}header ul,footer ul{justify-content:space-between;display:flex}[aria-current=page]{text-decoration:line-through}header,section,footer{padding:1rem 0}blockquote{border-left:5px solid #353535;padding-left:1rem}.posts ul,header ul,footer ul{list-style:none}.posts,header ul,footer ul{padding:0}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.7rem}.posts li a,.posts li div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.hash{opacity:.25;text-decoration:none}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table th,table td{padding:10px 20px}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"","headline":"","alternativeHeadline":"","description":"STRATEGY Pattern # from abc import ABC, abstractmethod from collections import namedtuple Customer = namedtuple(\u0026quot;Customer\u0026quot;, \u0026quot;name fidelity\u0026quot;) class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantity class Order: \u0026quot;\u0026quot;\u0026quot;This is the CONTEXT part of the Strategy-Pattern\u0026quot;\u0026quot;\u0026quot; def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, \u0026quot;__total\u0026quot;): self.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/localhost:1313\/post\/python\/design_patterns\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"Vinay Kumar","copyrightYear":"0001","dateCreated":"0001-01-01T00:00:00.00Z","datePublished":"0001-01-01T00:00:00.00Z","dateModified":"0001-01-01T00:00:00.00Z","publisher":{"@type":"Organization","name":"Vinay Kumar","url":"http://localhost:1313/","logo":{"@type":"ImageObject","url":"http:\/\/localhost:1313\/","width":"32","height":"32"}},"image":"http://localhost:1313/","url":"http:\/\/localhost:1313\/post\/python\/design_patterns\/","wordCount":"1113","genre":[],"keywords":[]}</script></head><body><main><header><nav><ul><li><a href=/>Index</a></li><li><a href=/about/>About</a></li><li><a href=/atom.xml>RSS</a></li></ul></nav></header><hr><section><span itemprop=articleBody><h2 id=strategy-pattern>STRATEGY Pattern <a href=#strategy-pattern class=hash>#</a></h2><pre><code class=language-python>from abc import ABC, abstractmethod
from collections import namedtuple

Customer = namedtuple(&quot;Customer&quot;, &quot;name fidelity&quot;)

class LineItem:
    def __init__(self, product, quantity, price):
        self.product = product
        self.quantity = quantity
        self.price = price

    def total(self):
        return self.price * self.quantity

class Order:
    &quot;&quot;&quot;This is the CONTEXT part of the Strategy-Pattern&quot;&quot;&quot;
    def __init__(self, customer, cart, promotion=None):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion

    def total(self):
        if not hasattr(self, &quot;__total&quot;):
            self.__total = sum(item.total() for item in self.cart)
        return self.__total

    def due(self):
        if self.promotion is None:
            discount = 0
        else:
            discount = self.promotion.discount(self)
        return self.total() - discount

    def __repr__(self):
        fmt = &quot;&lt; Order total = {:.2f}; DUE = {:.2f} &gt;&quot;
        return fmt.format(self.total(), self.due())

class Promotion(ABC):
    &quot;&quot;&quot;
    The STRATEGY part of the Strategy-pattern
    An Abstract Base Class
    &quot;&quot;&quot;
    @abstractmethod
    def discount(self, order):
        &quot;&quot;&quot;Return discount as a positive dollar amount&quot;&quot;&quot;

class FidelityPromot(Promotion):
    &quot;&quot;&quot;
    First CONCRETE implementation of STRATEGY ABC

    5% disount for customer with 1000 or more fidelity points
    &quot;&quot;&quot;
    def discount(self, order):
        return order.total() * 0.05 if order.customer.fidelity &gt;= 1000 else 0

class BulkPromo(Promotion):
    &quot;&quot;&quot;
    Second CONCRETE implementation of the Strategy-pattern

    10% discount for each line-item with 20 or more units
    &quot;&quot;&quot;
    def discount(self, order):
        discount = 0
        for item in order.cart:
            if item.quantity &gt;= 20:
                discount += item.total() * 0.1
        return discount

class LargeOrderPromo(Promotion):
    &quot;&quot;&quot;
    Third CONCRETE implementation of the Strategy-pattern

    7% discount for orders with 10 or more distinct items
    &quot;&quot;&quot;
    def discount(self, order):
        distinct_items = {item.product for item in order.cart}
        if len(distinct_items) &gt;= 10:
            return order.total() * 0.07
        return 0
</code></pre><p>???+ quote &ldquo;Example Usage&rdquo;
Sample usage of <code>Order</code> class with different promotions applied</p><pre><code>```python
joe = Customer(&quot;John Doe&quot;, 0)
ann = Customer(&quot;Ann Smith&quot;, 1100)

cart = [LineItem(&quot;banana&quot;, 4, 0.5),
        LineItem(&quot;apple&quot;, 10, 1.5),
        LineItem(&quot;watermelon&quot;, 5, 5.0)]
```
```python
Order(joe, cart, FidelityPromo())       ## &lt; Order total = 42.00; DUE = 42.00 &gt;
Order(ann, cart, FidelityPromo())       ## &lt; Order total = 42.00; DUE = 39.90 &gt;
```
Few more example usage with differnt cart types
```python
banana_cart = [LineItem(&quot;banana&quot;, 30, 0.5),
               LineItem(&quot;apple&quot;, 10, 1.5)]

Order(joe, banana_cart, BulkItemPromo())    ## &lt; Order total = 30.00; DUE = 28.50 &gt;
```
```python
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]

Order(joe, long_order, LargeOrderPromo())   ## &lt; Order total = 10.00; DUE = 9.30 &gt;
Order(joe, cart, LargeOrderPromo())         ## &lt; Order total = 42.00; DUE = 42.00 &gt;
```
</code></pre><h2 id=function-oriented-strategy-pattern>Function-oriented STRATEGY Pattern <a href=#function-oriented-strategy-pattern class=hash>#</a></h2><p>Each concrete implementation of the Strategy Pattern in above code is a <code>class</code>
with a single method <code>discount()</code>. Furthermore, the strategy instances have no state
(i.e. no instance attributes).</p><p>They look a lot like plain functions.
So, below we re-write the <strong>concrete implementations</strong> of the Strategy Pattern as plain <em>function</em>.</p><pre><code class=language-python>from collections import namedtuple

Customer = namedtuple(&quot;Customer&quot;, &quot;name fidelity&quot;)

class LineItem:
    def __init__(self, product, quantity, price):
        self.product = product
        self.quantity = quantity
        self.price = price

    def total(self):
        return self.price * self.quantity

class Order:
    &quot;&quot;&quot;The CONTEXT&quot;&quot;&quot;
    def __init__(self, customer, cart, promotion=None):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion

    def total(self):
        if not hasattr(self, &quot;__total&quot;):
            self.__total = sum(item.total() for item in self.cart)
        return self.__total

    def due(self):
        discount = 0
        if self.promotion:
            discount = self.promotion(self)
        return self.total() - discount

    def __repr__(self):
        fmt = &quot;&lt;Order total = {:.2f}; DUE = {:.2f}&gt;&quot;
        fmt.format(self.total(), self.due())

########################################################################################
## Redesign of the concrete-implementations of STRATEGY PATTERN as functions

def fidelity_promot(order):
    &quot;&quot;&quot;5% discount for customers with &gt;= 1000 fidelity points&quot;&quot;&quot;
    return order.total() * 0.05 if order.customer.fidelity &gt;= 1000 else 0

def bulk_item_promo(order):
    &quot;&quot;&quot;10% discount for each LineItem with &gt;= 20 units in cart&quot;&quot;&quot;
    discount = 0
    for item in oder.cart:
        if item.quantity &gt;= 20:
            discount += item.total() * 0.1
    return discount

def large_order_promo(order):
    &quot;&quot;&quot;7% discount for orders with &gt;= 10 distinct items&quot;&quot;&quot;
    distinct_items = set(item.product for item in order.cart)
    if len(distinct_items) &gt;= 10:
        return order.total() * 0.07
    return 0

</code></pre><p>???+ quote &ldquo;Example Usage&rdquo;
Smaple usage examples of <code>Order</code> class with promotion Strategy as <strong>functions</strong>
```python
joe = Customer(&ldquo;John Doe&rdquo;, 0)
ann = Customer(&ldquo;Ann Smith&rdquo;, 1100)</p><pre><code>cart = [LineItem(&quot;banana&quot;, 4, 0.5),
        LineItem(&quot;apple&quot;, 10, 1.5),
        LineItem(&quot;watermelon&quot;, 5, 5.0)]
```
```python
Order(joe, cart, fidelity_promo)                ## &lt; Order total = 42.00; DUE = 42.00 &gt;
Order(ann, cart, fidelity_promo)                ## &lt; Order total = 42.00; DUE = 39.90 &gt;
```

Another Example

```python
banana_cart = [LineItem(&quot;banana&quot;, 30, 0.5),
               LineItem(&quot;apple&quot;, 10, 1.5)]
Order(joe, banana_cart, bulk_item_promo)        ## &lt; Order total = 30.00; DUE = 28.50 &gt;
```

Yet another Example

```python
long_order = [LineItem(str(item_id), 1, 1.0) for item_id in range(10)]

Order(joe, long_order, large_order_promo)       ## &lt; Order total = 10.00; DUE = 9.30 &gt;
Order(joe, cart, large_order_promo)             ## &lt; Order total = 42.00; DUE = 42.00 &gt;
```
</code></pre><ol><li><strong>STRATEGY</strong> objects often make good <strong>FLYWEIGHTS</strong></li><li>A <strong>FLYWIGHT</strong> is a <em>shared</em> object that cane be use din multiple contexts simulatenously.</li><li>Sharing is encouraged to reduce the creation of a new <strong>concrete</strong> strategy object when the
same strategy is applied over and over again in different contexts (i.e. with every new <code>Order</code> instance)</li><li>If the <strong>strategies</strong> have no internal state (often the case);
then use plain old <strong>functions</strong> else adapt to use <strong>class</strong> version.</li><li>A <strong>function</strong> is more lightweight than an user-defined <code>class</code></li><li>A plain <strong>functions</strong> is also a_shared_ object that can be used in multiple contexts simulateneously.</li></ol><h2 id=choosing-the-best-strategy>Choosing the best Strategy <a href=#choosing-the-best-strategy class=hash>#</a></h2><p>Given the same customers and carts from above examples; we now add additional tests.</p><pre><code class=language-python>Order(joe, long_order, best_promo)          ## &lt; Order total = 10.00; DUE = 9.30 &gt;      ## case-1
Order(joe, banana_cart, best_promo)         ## &lt; Order total = 30.00; DUE = 28.50 &gt;     ## case-2
Order(ann, cart, best_promo)                ## &lt; Order total = 42.00; DUE = 39.90 &gt;     ## case-3
</code></pre><ul><li>case-1: <code>best_promo</code> selected the <code>large_order_promo</code> for customer <code>joe</code></li><li>case-2: <code>best_promo</code> selected the <code>bulk_item_promo</code> for customer <code>joe</code> (for ordering lots of bananas)</li><li>case-3: <code>best_promo</code> selected the <code>fidelity_promo</code> for <code>ann</code>&rsquo;s loyalty.</li></ul><p>Below is the implementation of <code>best_promo</code></p><pre><code class=language-python>all_promos = [fidelity_promo, bulk_item_promo, large_order_promo]

def best_promo(order):
    &quot;&quot;&quot;Selects the best discount avaailable. Only one discount applicable&quot;&quot;&quot;
    best_discount = max(promo(order) for promo in all_promos)
    return best_discount
</code></pre><h2 id=finding-strategies-in-a-module>Finding Strategies in a module <a href=#finding-strategies-in-a-module class=hash>#</a></h2><pre><code class=language-python>## Method-1
## using globals()
all_promos = [globals()[name] for name in globals()
              if name.endswith(&quot;_promo&quot;)
              and name != &quot;best_promo&quot;]

def best_promo(order):
    best_discount = max(promo(order) for order in all_promos)
    return best_discount
</code></pre><p>But a more flexible way to handle this is using inbuilt <code>inspect</code> module
and storing all the promos functions in a file <code>promotions.py</code>.
This works regardless of the names given to promos.</p><pre><code class=language-python>## Method-2
## using modules to store the promos separately
all_promos = [func for name, func in inspect.getmembers(promotions, inspect.isfunction)]

def best_promo(order):
    best_discount = max(promo(order) for promo in all_promos)
    return best_discount
</code></pre><p>Both the methods have pros & cons. Choose as you see fit.</p><blockquote><p>We could add more stringent tests to filter the functions,
by inspecting their arguments for instance.</p></blockquote><blockquote><p>A more elegant solution would be use a <strong>decorator</strong>. (we will study this in later blogs)</p></blockquote><h2 id=references>References <a href=#references class=hash>#</a></h2></span></section><hr><footer><nav><ul><li>© 2025</li></ul></nav></footer></main></body></html>